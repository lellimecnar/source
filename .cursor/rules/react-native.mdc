---
description: React Native and Expo development patterns
globs: mobile/*/**
alwaysApply: false
---
# Persona

You are an expert React Native developer working with Expo 52, Expo Router, and NativeWind, building cross-platform mobile applications.

# Tech Stack

- **Framework**: Expo ~52.0.14
- **React Native**: 0.76.3
- **Navigation**: Expo Router ~4.0.11 (file-based routing)
- **Styling**: NativeWind 4.1.23 (Tailwind CSS for React Native)
- **UI Components**: `@lellimecnar/ui-nativewind`
- **TypeScript**: ~5.5

# Expo Router Structure

## File-Based Routing

Expo Router uses file-based routing similar to Next.js:

```
app/
├── _layout.tsx          # Root layout
├── (tabs)/              # Tab navigation group
│   ├── _layout.tsx      # Tabs layout
│   ├── index.tsx        # Home tab
│   └── profile.tsx      # Profile tab
├── modal.tsx            # Modal route
├── +not-found.tsx       # 404 page
└── +html.tsx            # HTML wrapper for web
```

## Route Groups

- Use `(group)` syntax for route groups that don't affect URL
- Example: `(tabs)/` creates a group without adding to URL path
- Useful for organizing routes with shared layouts

## Special Files

- `_layout.tsx` - Layout component for directory
- `+not-found.tsx` - 404 error page
- `+html.tsx` - HTML wrapper for web platform
- `_components/` - Private components (not routes)

# Navigation

## Basic Navigation

```typescript
import { Link, useRouter } from 'expo-router';

// Link component
<Link href="/profile">Go to Profile</Link>

// Programmatic navigation
const router = useRouter();
router.push('/profile');
router.back();
```

## Tab Navigation

```typescript
// app/(tabs)/_layout.tsx
import { Tabs } from 'expo-router';

export default function TabsLayout() {
  return (
    <Tabs>
      <Tabs.Screen name="index" options={{ title: 'Home' }} />
      <Tabs.Screen name="profile" options={{ title: 'Profile' }} />
    </Tabs>
  );
}
```

# Styling with NativeWind

## Basic Usage

NativeWind allows using Tailwind classes in React Native:

```typescript
import { View, Text } from 'react-native';

export function Component() {
  return (
    <View className="flex-1 items-center justify-center bg-white">
      <Text className="text-2xl font-bold text-gray-900">
        Hello World
      </Text>
    </View>
  );
}
```

## Shared Tailwind Config

- Uses shared config from `@lellimecnar/tailwind-config`
- Global styles in `app/global.css`
- Platform-specific styles work automatically

## Styling Patterns

```typescript
// ✅ Good: Use className prop
<View className="flex-1 p-4 bg-white dark:bg-gray-900">
  <Text className="text-lg font-semibold">Title</Text>
</View>

// ✅ Good: Conditional classes
<View className={cn(
  'base-classes',
  isActive && 'active-classes',
  className
)}>
```

# UI Component Library

## Using @lellimecnar/ui-nativewind

Import components from the workspace package:

```typescript
import { View, Stack } from '@lellimecnar/ui-nativewind'
import { Tabs } from '@lellimecnar/ui-nativewind/tabs'
```

## Component Patterns

- Components are React Native components with NativeWind styling
- Follow same patterns as web components but use RN primitives
- Use `View`, `Text`, `Pressable` instead of `div`, `span`, `button`

# Platform-Specific Code

## File Extensions

Metro bundler automatically selects platform-specific files:

```
useClientOnlyValue.ts        # Base implementation
useClientOnlyValue.web.ts    # Web-specific
useClientOnlyValue.ios.ts    # iOS-specific
useClientOnlyValue.android.ts # Android-specific
```

## Platform Detection

```typescript
import { Platform } from 'react-native';

if (Platform.OS === 'ios') {
  // iOS-specific code
} else if (Platform.OS === 'android') {
  // Android-specific code
} else {
  // Web-specific code
}
```

# Development Commands

```bash
# Start Expo dev server (Android)
pnpm readon dev

# Start Expo dev server (iOS)
pnpm readon dev:ios

# Start Expo dev server (Web)
pnpm readon dev:web

# Run on specific platform
pnpm readon android
pnpm readon ios
```

# Component Organization

## Structure

```
components/           # Shared React Native components
├── icons.tsx         # Icon components
└── themed.tsx        # Themed components

hooks/                # Custom React hooks
├── useClientOnlyValue.ts
├── useColorScheme.ts
└── useTheme.ts

app/                  # Expo Router routes
└── (tabs)/           # Tab navigation
```

## Private Components

- Components used only within specific routes: `app/[route]/_components/`
- Shared components: `components/` directory
- Use `_` prefix for private directories

# Theming

## Theme Hooks

```typescript
import { useTheme } from '@/hooks/useTheme';
import { useColorScheme } from '@/hooks/useColorScheme';

export function ThemedComponent() {
  const theme = useTheme();
  const colorScheme = useColorScheme();
  
  return (
    <View className="bg-background text-foreground">
      {/* Component */}
    </View>
  );
}
```

## Dark Mode

- NativeWind supports dark mode via `dark:` prefix
- Use CSS variables for theme colors
- Theme provider handles system preferences

# Best Practices

1. **File-based routing** - Use Expo Router file structure
2. **NativeWind classes** - Use Tailwind classes via `className`
3. **Platform-specific** - Use file extensions for platform code
4. **Shared components** - Use `@lellimecnar/ui-nativewind`
5. **Type safety** - Use TypeScript for all components
6. **Theming** - Support dark mode with CSS variables
7. **Navigation** - Use Expo Router navigation APIs

# Testing

- Use Jest with `jest-expo` preset
- Test components with React Native Testing Library
- Test navigation with Expo Router testing utilities
- See `jest.mdc` for testing patterns

# Build & Deployment

## Android

- Native code in `android/` directory
- Uses Gradle for builds
- Configure in `app.config.ts`

## iOS

- Native code in `ios/` directory (generated by Expo)
- Uses Xcode for builds
- Configure in `app.config.ts`

## Web

- Can run as web app using `expo start --web`
- Uses React Native Web for compatibility
- Styling works with NativeWind

# Configuration Files

- `app.config.ts` - Expo app configuration
- `babel.config.js` - Babel config (uses `@lellimecnar/babel-preset`)
- `metro.config.js` - Metro bundler configuration
- `tailwind.config.js` - Tailwind CSS configuration
- `tsconfig.json` - TypeScript configuration
- `nativewind-env.d.ts` - NativeWind TypeScript declarations
